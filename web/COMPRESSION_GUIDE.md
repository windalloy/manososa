# 图片压缩优化指南

## 当前设置

你的项目当前使用：
- **质量 (quality)**: 80
- **压缩努力 (effort)**: 4

## 压缩参数说明

### Quality (质量) - 1-100
- **90-100**: 接近无损，体积大
- **80-89**: 高质量，体积中等（当前设置）
- **70-79**: 平衡，体积较小，质量可接受（推荐）
- **60-69**: 高压缩，体积小，质量略有下降
- **50-59**: 极高压缩，体积很小，质量明显下降

### Effort (压缩努力) - 0-9
- **0-3**: 快速，压缩率低
- **4-6**: 平衡（当前设置）
- **7-9**: 慢速，压缩率高（推荐用于生产环境）

## 优化建议

### 方案 1: 平衡模式（推荐）⭐
**预期效果**: 体积减少 15-25%，质量几乎无影响

```bash
node convert-images-optimized.js balanced
```

**配置**:
- AVIF (背景): quality=70, effort=6
- WebP (其他): quality=75, effort=6

**适用场景**: 大多数情况，质量与体积的最佳平衡

### 方案 2: 自定义模式（最优化）⭐⭐
**预期效果**: 体积减少 20-30%，针对不同图片类型优化

```bash
node convert-images-optimized.js custom
```

**配置**:
- 背景图片 (AVIF): quality=65, effort=6
- 立绘图片 (WebP): quality=75, effort=6
- 证物图片 (WebP): quality=72, effort=6
- UI 图片 (WebP): quality=70, effort=6
- 其他图片 (WebP): quality=72, effort=6

**适用场景**: 追求最佳压缩效果，愿意针对不同图片类型调整

### 方案 3: 高压缩模式
**预期效果**: 体积减少 30-40%，质量略有下降

```bash
node convert-images-optimized.js aggressive
```

**配置**:
- AVIF (背景): quality=60, effort=7
- WebP (其他): quality=70, effort=7

**适用场景**: 网络环境较差，优先考虑加载速度

## 质量影响评估

### Quality 80 → 70 (推荐)
- **体积减少**: 约 15-20%
- **质量影响**: 几乎不可察觉
- **适用**: 所有图片类型

### Quality 80 → 65 (背景图片)
- **体积减少**: 约 25-30%
- **质量影响**: 轻微，背景图片通常不需要太多细节
- **适用**: 背景图片

### Quality 80 → 75 (立绘图片)
- **体积减少**: 约 10-15%
- **质量影响**: 无影响
- **适用**: 立绘、证物等需要细节的图片

### Quality 80 → 60 (高压缩)
- **体积减少**: 约 30-40%
- **质量影响**: 轻微可见，但通常可接受
- **适用**: 网络环境较差时

## 实际测试建议

### 步骤 1: 备份当前图片
```bash
# 备份当前的 WebP 和 AVIF 文件
cp -r src/assets src/assets_backup
```

### 步骤 2: 测试不同配置
```bash
# 测试平衡模式
node convert-images-optimized.js balanced

# 在浏览器中检查图片质量
# 如果满意，继续；如果不满意，尝试其他配置
```

### 步骤 3: 对比效果
1. 打开浏览器开发者工具
2. 查看 Network 面板
3. 对比文件大小
4. 肉眼检查图片质量

### 步骤 4: 选择最佳配置
根据测试结果选择最适合的配置

## 压缩效果预估

基于 quality 80 → 70 的调整：

| 图片类型 | 当前大小 | 优化后大小 | 减少比例 |
|---------|---------|-----------|---------|
| 背景 (AVIF) | 100% | 75-80% | 20-25% |
| 立绘 (WebP) | 100% | 85-90% | 10-15% |
| 证物 (WebP) | 100% | 85-90% | 10-15% |
| UI (WebP) | 100% | 80-85% | 15-20% |

**总体预期**: 如果当前总大小为 50MB，优化后可能减少到 38-42MB（减少 16-24%）

## 注意事项

1. **转换时间**: effort 越高，转换时间越长
   - effort 4: 快速（当前）
   - effort 6: 中等（推荐）
   - effort 7-9: 较慢，但压缩效果更好

2. **质量检查**: 转换后务必检查关键图片的质量
   - 立绘图片：检查细节是否清晰
   - 背景图片：检查是否有明显压缩痕迹
   - 证物图片：检查文字和细节是否清晰

3. **渐进式优化**: 建议先测试几张图片，确认质量后再批量转换

4. **浏览器兼容性**: 
   - WebP: 现代浏览器广泛支持
   - AVIF: Chrome 85+, Edge 85+, Firefox 93+

## 推荐工作流程

1. **开发阶段**: 使用 `balanced` 模式
2. **生产部署**: 使用 `custom` 模式（最优化）
3. **网络较差**: 使用 `aggressive` 模式

## 快速开始

```bash
# 1. 使用平衡模式（推荐）
node convert-images-optimized.js balanced

# 2. 检查图片质量，如果满意就完成
# 3. 如果不满意，尝试自定义模式
node convert-images-optimized.js custom

# 4. 如果还需要更小体积，尝试高压缩模式
node convert-images-optimized.js aggressive
```

## 质量对比工具

可以使用在线工具对比不同 quality 设置的效果：
- https://squoosh.app/ (Google 的图片压缩工具)
- https://imagemagick.org/ (命令行工具)

在 Squoosh 中，你可以：
1. 上传原始图片
2. 调整 quality 参数
3. 实时查看压缩效果和文件大小
4. 找到最佳平衡点


